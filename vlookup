import pandas as pd
from datetime import datetime

# Load the CSV and Excel files
data_df = pd.read_csv('data.csv')
excel_df = pd.read_excel('All Subs Netguru Report.xlsx', sheet_name='Azure')

# Ensure both dataframes are in the same case for comparison
data_df['Subscription ID'] = data_df['Subscription ID'].str.lower()
excel_df['Subscription ID'] = excel_df['Subscription ID'].str.lower()

# Merge the dataframes on the 'Subscription ID' column
merged_df = pd.merge(excel_df, data_df[['Subscription ID', 'Compliance Status']], on='Subscription ID', how='left')

# Create a new column with today's date and fill with 'Compliance Status'
today_date = datetime.today().strftime('%Y-%m-%d')
merged_df[today_date] = merged_df['Compliance Status']

# Drop the extra 'Compliance Status' column used for merging
merged_df = merged_df.drop(columns=['Compliance Status'])

# Save the updated dataframe back to the Excel file
with pd.ExcelWriter('All Subs Netguru Report.xlsx', mode='a', if_sheet_exists='replace') as writer:
    merged_df.to_excel(writer, sheet_name='Azure', index=False)

print(f"Data has been successfully updated with a new column '{today_date}'.")
